{% extends "base.html" %}

{% block title %}{{ bank.name }} - Banca de Întrebări{% endblock %}

{% block content %}
<div class="container" style="padding:40px 0">
    <a href="{{ url_for('main.professor_dashboard') }}">← Înapoi la Panou Profesor</a>
    <h1 style="margin-top:10px">❓ {{ bank.name }}</h1>
    <p>{{ bank.description }}</p>
    <div style="margin-top:20px">
        <button class="btn btn-primary" onclick="showAddQuestionModal()">+ Adaugă Întrebare</button>
        <div style="margin-top:20px">
            <h3>Întrebări ({{ questions|length }})</h3>
            {% if questions and questions|length > 0 %}
            <div class="banks-grid" style="grid-template-columns: 1fr; gap:12px; margin-top:12px">
                {% for q in questions %}
                <div class="bank-card" style="padding:12px; background:#fff; color:#111; cursor:default">
                    <h4 style="margin:0 0 8px 0">{{ q.text[:120] }}{% if q.text|length > 120 %}...{% endif %}</h4>
                    <div style="font-size:13px; color:#666">Tip: {{ q.question_type }} | Dificultate: {{ q.difficulty }}</div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Nicio întrebare încă.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Add Question Modal (simple) -->
<div id="addQuestionModal" class="modal" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Adaugă Întrebare în {{ bank.name }}</h3>
            <span class="close" onclick="closeAddQuestionModal()">&times;</span>
        </div>
        <form id="addQuestionForm">
            <div class="form-group">
                <label>Text întrebare</label>
                <textarea id="questionText" required rows="4"></textarea>
            </div>
            <div class="form-group">
                <label>Tip</label>
                <select id="questionType">
                    <option value="multiple_choice">Multiple Choice</option>
                    <option value="essay">Essay</option>
                    <option value="true_false">True/False</option>
                </select>
            </div>
            <div class="form-group">
                <label>Dificultate (1-5)</label>
                <input type="number" id="questionDifficulty" min="1" max="5" value="1">
            </div>
            <button type="submit" class="btn btn-success">Adaugă</button>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showAddQuestionModal() {
    const modal = document.getElementById('addQuestionModal');
    modal.style.display = 'flex';
    setTimeout(() => modal.classList.add('show'), 10);
}

function closeAddQuestionModal() {
    const modal = document.getElementById('addQuestionModal');
    modal.classList.remove('show');
    setTimeout(() => modal.style.display = 'none', 300);
}


document.getElementById('addQuestionForm')?.addEventListener('submit', function(e){
    e.preventDefault();
    const payload = {
        text: document.getElementById('questionText').value,
        question_type: document.getElementById('questionType').value,
        difficulty: parseInt(document.getElementById('questionDifficulty').value, 10)
    };

    fetch(`/api/question-banks/{{ bank.id }}/add-question`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            alert('Întrebare adăugată!');
            closeAddQuestionModal();
            location.reload();
        } else {
            alert('Eroare: ' + data.error);
        }
    });
});
</script>
<style>
    /* Centrăm modalul pe ecran */
    #addQuestionModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Fundal semi-transparent */
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        width: 400px; /* Lățime fixă pentru modal */
        max-width: 90%; /* Să nu depășească 90% din lățimea ecranului pe dispozitive mici */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 18px;
    }

    .close {
        font-size: 30px;
        cursor: pointer;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        display: block;
        font-weight: bold;
    }

    .form-group textarea,
    .form-group select,
    .form-group input {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .form-group textarea {
        resize: vertical;
    }

    .btn {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
    }

    /* Efect de tranziție pentru modal */
    #addQuestionModal {
        transition: opacity 0.3s ease;
    }

    #addQuestionModal.show {
        display: flex;
        opacity: 1;
    }
</style>

{% endblock %}